#!/bin/bash

check_commands cmake ninja "$CXX"

options=()
while [ ! -z ${1+x} ]; do
    case $1 in
    -optimizer)
        enable_optimizer=yes
        check_commands python3
        ;;
    *)
        options+=($1)
        ;;
    esac
    shift
done

enter_git_repository https://github.com/KhronosGroup/glslang "$version"

if [ -z ${enable_optimizer+x} ]; then
    options+=(-DENABLE_OPT=OFF)
else
    if [ $version == 11.9.0 ]; then
        spirv_version=1.3.211.0
    else
        echo "error: unknown SPIRV-Tools version"
        exit 1
    fi
    provides spirv-headers $spirv_version
    provides spirv-tools $spirv_version
    # download and use SPIRV-Tools and SPIRV-headers
    ./update_glslang_sources.py
    options+=(-DENABLE_OPT=ON)
fi

build_and_install cmake "${options[@]}"
