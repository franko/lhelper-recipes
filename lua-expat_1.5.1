dependency lua
dependency expat
enter_git_repository "https://github.com/lunarmodules/luaexpat" "$version"

# using the "src" subdirectory
cd src

cat << EOF > meson.build
project('lua-expat', 'c')

lua_puc_rio_dep = dependency('lua', required : false)
if lua_puc_rio_dep.found()
    lua_dep = lua_puc_rio_dep
    lua_abiver = lua_dep.version().substring(0, 3)
else
    lua_dep = dependency('luajit')
    if lua_dep.version().substring(0, 3) in ['2.0', '2.1']
        lua_abiver = '5.1'
    else
        error('unknown luajit version: ' + lua_dep.version())
    endif
endif

expat_dep = dependency('expat')

shared_library('lxp', 'lxplib.c',
    dependencies : [expat_dep, lua_dep],
    name_prefix : '',
    install_dir : 'lib/lua/' + lua_abiver,
    install : true,
)

install_data(
    'lxp/lom.lua',
    'lxp/totable.lua',
    'lxp/threat.lua',
    install_dir: 'share/lua/' + lua_abiver,
    preserve_path: true,
)
EOF

build_and_install meson "$@"

