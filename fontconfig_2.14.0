#!/bin/bash
check_commands meson ninja "$CC"

enter_archive "https://www.freedesktop.org/software/fontconfig/release/fontconfig-${version}.tar.gz"

options=("-Ddoc=disabled" "-Dnls=disabled" "-Dtests=disabled" "-Dcache-build=disabled")
enable_tools=disabled
while [ ! -z ${1+x} ]; do
    case $1 in
    -tools)
        enable_tools=enabled
        ;;
    *)
        options+=("$1")
        ;;
    esac
    shift
done

options+=("-Dtools=$enable_tools")

build_and_install meson "${options[@]}"

if [[ "${INSTALL_PREFIX+set}" == set && -d "$INSTALL_PREFIX" ]]; then
    echo "Removing fontconfig config files"
    rm -fr "$INSTALL_PREFIX/share" "$INSTALL_PREFIX/etc/fonts"
else
    echo "internal error with variable INSTALL_PREFIX: $INSTALL_PREFIX"
    exit 1
fi

